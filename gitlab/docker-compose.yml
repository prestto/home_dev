version: "3"

services:

  gitlab:
    image: "gitlab/gitlab-ce:latest"
    restart: always
    environment:
      GITLAB_OMNIBUS_CONFIG: |
        external_url "http://gitlab.dali.dev"
      GITLAB_SKIP_PG_UPGRADE: "true"
    expose:
      - "80"
      - "22"
    networks:
      - app-network

  container_nginx:
    build:
      context: .
      dockerfile: docker/Dockerfile_nginx
    ports:
      - "30022:22"
      - "80:80"
      - "443:443"
    networks:
      - app-network
    volumes:
    - type: bind
      source: ./nginx/conf
      target: /conf
    depends_on:
      - gitlab
    label: "blah"
    command: nginx -c /conf/gitlab-omnibus-ssl-nginx.conf

networks:
  app-network:
    driver: bridge
